<!DOCTYPE html>
<html lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="UTF-8">
<title>Cards Collector's</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
	<div th:replace="menu :: menu"></div>
	<div class = "container-fluid">
		<div class="row" style="margin-top:56px;">
			<div class="col-pixel-width vertical-menu">
				<div class="btn-block vertical-menu-top">Select Rarities</div>
				<div th:each="rarity : ${rarities}">
					<div th:if="${rarity.value}" th:with="start=${#strings.startsWith(selectedRarities, rarity.key)}, end=${#strings.endsWith(selectedRarities, rarity.key)}">
						<div th:if="${start or end}">
							<div th:if="${start}" th:classappend="${rarity.value == true ? 'vertical-menu-selected' : ''}">
								<a class="btn-block" th:href="@{/gallery(rarity=${#strings.substringAfter(selectedRarities, rarity.key + ',')},__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}" th:text="${rarity.key}"></a>
							</div>
							<div th:if="${end and !start}" th:classappend="${rarity.value == true ? 'vertical-menu-selected' : ''}">
								<a class="btn-block" th:href="@{/gallery(rarity=${#strings.substringBefore(selectedRarities, ',' + rarity.key)},__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}" th:text="${rarity.key}"></a>
							</div>
						</div>
						<div th:unless="${start or end}"  th:classappend="${rarity.value == true ? 'vertical-menu-selected' : ''}">
							<a class="btn-block" th:href="@{/gallery(rarity=${#strings.replace(selectedRarities, rarity.key + ',', '')},__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}" th:text="${rarity.key}"></a>
						</div>
					</div>
					<div th:unless="${rarity.value}">
						<a class="btn-block" th:href="@{/gallery(rarity=${selectedRarities + (selectedRarities == '' ? '' : ',') + rarity.key},__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}" th:text="${rarity.key}"></a>
					</div>
				</div>
			</div>
			<div class="col">
				<div class="row">
					<div class="col px-0">
						<div class="topnav">
							<a class="disabled active"> Sort By</a>
					  		<div th:each="sortOption : ${sortOptions}">
					  			<form th:action="@{/gallery(page=${currentPage},__${selectedRarities == '' ? ',' : 'rarity=${selectedRarities}'}__,__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}" th:object="${selectedSortOption}" method="post">
					  				<button type="submit" th:name="string" th:value="${sortOption}" th:text="${sortOption.getName()}" th:classappend="${sessionData.getSortType() == sortOption ? 'active' : ''}"></button>
					  			</form>
					  		</div>
					  		<div class="dropdown">
  								<button class="btn dropdown-button">Order</button>
								<div class="dropdown-content">
 									<form th:action="@{/gallery(page=${currentPage},__${selectedRarities == '' ? ',' : 'rarity=${selectedRarities}'}__,__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}" th:object="${selectedOrderOption}" th:each="orderType : ${sessionData.getSortType().orderTypeValues()}" method="post">
						  				<button type="submit" th:name="string" th:value="${orderType}" th:text="${orderType.getName()}" th:classappend="${sessionData.getOrderType() == orderType ? 'active' : ''}"></button>
					  				</form>
								</div>
							</div> 
					  		<div class="search-container">
					  			<div class="form-inline">
   									<form id="search-form" th:action="@{/gallery(__${selectedRarities == '' ? ',' : 'rarity=${selectedRarities}'}__)}" method="post">
   										<input type="text" class="form-control mr-2" id="search" th:name="search" th:value="${enteredSearch == '' ? '' : enteredSearch}" placeholder="Search ...">
 									</form>
 									<button onclick="document.getElementById('search').value = ''" class="btn">
 									   		<img th:src="@{images/cancel.png}" class="center" width="18" height="20" alt="C">
 									</button>
 									<button type="submit" form="search-form" class="btn">
   											<img th:src="@{images/search.png}" class="center" width="18" height=20 alt="S">
   									</button>
 								</div>
 							</div>
						</div>
					</div>
				</div>
				<div class = "container-fluid">
					<div class="row">
						<div class ="col px-3">
							<h1>Gallery</h1>
						</div>
					</div>
					<div>
						<hr>
					</div>
					<th:block th:with="counter=${100}">
    					<div th:each="row : ${#numbers.sequence(0, cards.size(), counter)}"  class="row justify-content-left px-3">
       						<div th:each="column : ${#numbers.sequence(0, counter - 1)}">
       							<div class="card mx-2 my-3 d-block" style="width:240px;" th:if="${row + column < cards.size()}" th:with="card=${cards.get(row + column)}">
       								<img  class="card-img-top" th:alt="${card.getName()}" th:src="${card.getImageUrl()}"> 
  									<div class="card-body">	
  										<span class="float-left" th:text="${card.getName()}"></span>
  										<span class="float-right" th:text="${' x' + card.getQuantity()}"></span>
  										<br>
  										<span class="float-left" th:text="${'Rarity '}"></span>
  										<span class="float-right" th:text="${card.getRarity().getId()}"></span>
  										<br>
  									</div>
  									<div class="card-footer">
  										<a class="btn btn-primary btn-block card-link" th:href="@{/gallery/buy(id=${card.getId()}, page=${currentPage},__${selectedRarities == '' ? ',' : 'rarity=${selectedRarities}'}__,__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}" th:text="${'Buy ' + card.getCost()}" th:classappend="${coins < card.getCost() ? 'disabled' : ''}"></a>
									</div>
								</div>
       						</div>
   						 </div>
					</th:block>
				</div>
				<div class="row justify-content-center" style="margin-top:50px; margin-bottom:50px;" th:if="${numberOfPages > 1}">
					<div class="col-auto">
						<table class="table table-responsive">
							<tr class="pagination pagination-lg" th:with="start=${currentPage > 5 ? (currentPage < numberOfPages - 5 ? currentPage - 4 : numberOfPages - 10) : 2}">
  								<td class="px-0 page-item" th:classappend="${currentPage == 1 ? 'disabled' : ''}">
  									<a class="page-link" th:href="@{${link}(page = ${currentPage - 1},__${selectedRarities == '' ? ',' : 'rarity=${selectedRarities}'}__,__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}">Previous</a>
  								</td>
  								<td class="px-0 page-item" th:classappend="${currentPage == 1 ? 'active' : ''}">
  									<a class="page-link" th:text="${1}" th:href="@{${link}(page = ${1},__${selectedRarities == '' ? ',' : 'rarity=${selectedRarities}'}__,__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}"></a>
  								</td>
  								<td class="px-0 page-item" th:if="${numberOfPages > 2}" th:each="number : ${#numbers.sequence(numberOfPages > 11 ? start : 2, numberOfPages > 11 ? start + 9 : numberOfPages - 1)}" th:classappend="${currentPage == number ? 'active' : ''}">
  									<a class="page-link" th:text="${number}" th:href="@{${link}(page = ${number},__${selectedRarities == '' ? ',' : 'rarity=${selectedRarities}'}__,__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}"></a>
  								</td>
  								<td class="px-0 page-item" th:classappend="${currentPage == numberOfPages ? 'active' : ''}">
  									<a class="page-link" th:text="${numberOfPages}" th:href="@{${link}(page = ${numberOfPages},__${selectedRarities == '' ? ',' : 'rarity=${selectedRarities}'}__,__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}"></a>			
  								</td>
  								<td class="px-0 page-item" th:classappend="${currentPage == numberOfPages ? 'disabled' : ''}">
  									<a class="page-link" th:href="@{${link}(page = ${currentPage + 1},__${selectedRarities == '' ? ',' : 'rarity=${selectedRarities}'}__,__${enteredSearch == '' ? ',' : 'search=${enteredSearch}'}__)}">Next</a>
  								</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>